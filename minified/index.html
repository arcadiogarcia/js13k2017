<style media="screen" type="text/css">
    body {
        text-align: center;
        margin: 0px;
        background-color: black;
    }

    canvas,
    img {
        image-rendering: optimizeSpeed;
        image-rendering: -moz-crisp-edges;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimize-contrast;
        image-rendering: pixelated;
        -ms-interpolation-mode: nearest-neighbor;
    }

    canvas {
        width: 100%;
        height: 100%;
    }
</style>

<body>
    <canvas id=a>
        <script>
            imgs={};Promise.all(["a","b","c","c2","h","k","m"].map(x=>{imgs[x]=new Image()imgs[x].src=x+".png";return new Promise(function(a,b){imgs[x].onload=a})})).then(start);x=a.getContext`2d`;colors=["red","blue","green","yellow","lime","aqua","orange","fuchsia"]bombs=["https://www.youtube.com/watch?v=dQw4w9WgXcQ","http://christmaschebacca.ytmnd.com/","https://www.badgerbadgerbadger.com/","http://fakebsod.com/generic","http://dn.ht/picklecat/","http://mischiefmakersmanual.com/tools/annoy/homepage.html"]m=false function start(){if(window.location.hash==""){a.width=x.width=window.innerWidth a.height=x.height=window.innerHeight localStorage.p="[]"localStorage.g="[]"p=[]if(!navigator.serviceWorker){x.fillStyle="black";x.fillRect(0,0,a.width,a.height)x.fillStyle="white"x.font="30px Sans-serif"x.textAlign="center"x.fillText("Service Worker not supported",a.width/2,200)x.font="25px Sans-serif"x.fillText("Upgrade your browser to play the game",a.width/2,250)return}navigator.serviceWorker.register('w.js').then(function(){updater()onclick=()=>{onclick=()=>{};updated();navigator.serviceWorker.controller.postMessage('s');startSound()}}).catch(function(a){console.log('Service worker registration failed:',a)});x.fillStyle="black";x.fillRect(0,0,a.width,a.height)x.fillStyle="white"x.font="60px Sans-serif"x.textAlign="center"x.fillText("Lost Tab",a.width/2,200)x.font="30px Sans-serif"x.fillText("The Evil Autoplaying Video Strikes Again",a.width/2,250)x.font="40px Sans-serif"x.fillText("Click to start",a.width/2,600)x.font="20px Sans-serif"x.fillText("Please make sure to allow pop-ups",a.width/2,650)document.title="Lost Tab"updated=function(){g=JSON.parse(localStorage.g);p=JSON.parse(localStorage.p);x.fillStyle="black";x.fillRect(0,0,a.width,a.height)x.fillStyle="white"x.font="30px Sans-serif"x.fillText("Inventory:",100,100)document.title="Inventory"p.forEach(function(s,j){x.fillStyle=colors[s[1]]||"white";x.fillRect(20+j%4*120,220+Math.floor(j/4)*120,100,100)x.drawImage(imgs[s[0]],0,0,16,16,20+j%4*120,220+Math.floor(j/4)*120,100,100)})}}else{var c=window.innerHeight>window.innerWidth?window.innerWidth:window.innerHeight;a.style.height=a.style.width=c;function draw(a,b){x.fillStyle="black";x.fillRect(0,0,40,40)x.fillStyle=a;x.fillRect(12,12,16,16)x.drawImage(b,12,12)}a.width=x.width=40 a.height=x.height=40 updated=function(){g=JSON.parse(localStorage.g);p=JSON.parse(localStorage.p);s=g[parseInt(window.location.hash.substring(1))]if(m){document.title=s.map(x=>{return{"a":"Autoplaying media","b":"Bomb","c":"Crate","h":"Keyhole #"+x.substring(1),"k":"Key #"+x.substring(1),"m":"Map"}[x[0]]}).reduce((x,y)=>y+"->"+x)}else{document.title="???"}draw(colors[s[s.length-1].substring(1)]||"white",imgs[s[s.length-1][0]])}updated()onclick=e=>{switch(s[s.length-1][0]){case"a":break;case"c":t=0 it=setInterval(()=>{draw("white",imgs["c2"])x.globalAlpha=t/8;x.fillStyle="black"x.fillRect(0,0,a.width,a.height)x.globalAlpha=1;t++},50);s.pop();setTimeout(()=>{save()clearInterval(it)},500)break;case"h":j=p.indexOf("k"+s[s.length-1].substring(1))if(j!=-1){s.pop();p.splice(j,1)save()}break;case"k":p.push(s.pop());save();break;case"m":navigator.serviceWorker.controller.postMessage('m');close()break}onfocus()}updater()window.onfocus=function onfocus(){if(s[s.length-1]=="b"&&localStorage.l=="l"){setTimeout(()=>{draw("yellow",imgs["b"])},300);setTimeout(()=>{draw("red",imgs["b"])},600);setTimeout(()=>{window.open(bombs[Math.floor(bombs.length*Math.random())],'_blank')close()},900)}if(s[s.length-1]=="a"&&localStorage.l=="l"){setTimeout(()=>{navigator.serviceWorker.controller.postMessage('w')},900)}}}}function save(){g[parseInt(window.location.hash.substring(1))]=s localStorage.g=JSON.stringify(g)localStorage.p=JSON.stringify(p)navigator.serviceWorker.controller.postMessage('u')}function updater(){navigator.serviceWorker.addEventListener('message',e=>{switch(e.data.k){case"l":g=e.data.a;localStorage.g=JSON.stringify(g);localStorage.l=""e.data.a.forEach((x,i)=>window.open(location+"#"+i,'_blank'),false);localStorage.l="l"break;case"u":updated()break;case"w":if(window.location.hash!==""){close()}else{x.fillStyle="black";x.fillRect(0,0,a.width,a.height)x.fillStyle="white"x.font="60px Sans-serif"x.textAlign="center"x.fillText("You won!",a.width/2,200)x.font="30px Sans-serif"x.fillText("The tab containing the video",a.width/2,250)x.fillText("has been found and destroyed",a.width/2,280)x.fillText("by a thousand garbage collectors.",a.width/2,310)x.fillText("Click to play again",a.width/2,600)document.title="You won!"onclick=()=>location=location;stopSound()}break;case"m":m=true updated()break}})}function startSound(){audioContext=new AudioContext();var f=4096;pinkNoise=(function(){var b,b1,b2,b3,b4,b5,b6,white;b=b1=b2=b3=b4=b5=b6=0.0;var t=0;var c=100;var d=audioContext.createScriptProcessor(f,1,1);d.onaudioprocess=function(e){var a=e.outputBuffer.getChannelData(0);white=Math.random()*2-1;for(var i=0;i<f;i++){if(Math.random()>0.9){if(Math.random()>0.9){c=Math.ceil(Math.random()*5)*Math.ceil(Math.random()*5)}white=Math.random()*2-1}else{white=Math.sin((t++)/c)}b=0.99886*b+white*0.0555179;b1=0.99332*b1+white*0.0750759;b2=0.96900*b2+white*0.1538520;b3=0.86650*b3+white*0.3104856;b4=0.55000*b4+white*0.5329522;b5=-0.7616*b5-white*0.0168980;a[i]=b+b1+b2+b3+b4+b5+b6+white*0.5362;a[i]*=0.11;b6=white*0.115926}}return d})();pinkNoise.connect(audioContext.destination)}function stopSound(){pinkNoise.disconnect()}
        </script>